{
  "properties": {
    "mer_no": {
      "bsonType": "string",
      "title": "No",
      "description": "Merchandise Number",
      "minLength": 10,
      "maxLength": 16,
      "pattern": "^[A-Z0-9-]{10,16}$",
      "width": 110
    },
    "mer_line_no": {
      "bsonType": "string",
      "title": "Line",
      "description": "Line Number",
      "minLength": 1,
      "maxLength": 4,
      "pattern": "^[0-9]{1,4}$",
      "width": 110
    },
    "mer_status": {
      "bsonType": "string",
      "title": "Status",
      "description": "Merchandise Status",
      "enum": [
        "00-Open",
        "01-StandBy",
        "10-OnTheWay",
        "20-OnCustoms",
        "30-OnCustomsProcess",
        "40-ClearanceCompleted",
        "50-OnTheTouchpoint",
        "60-ReadyToBeDelivered",
        "70-Delivered",
        "BL-Backlog",
        "NE-Missing",
        "WF-WriteOff",
        "RE-Remittance",
        "SP-ServicePack",
        "EX-Exported",
        "AR-Archived"
      ],
      "default": "00-Open",
      "width": 160
    },
    "mer_bill_no": {
      "bsonType": "string",
      "title": "Invoice No",
      "description": "Invoice Number",
      "minLength": 10,
      "maxLength": 10,
      "pattern": "^[A-Z0-9]{10,10}$",
      "width": 130
    },
    "mer_acc_no": {
      "bsonType": "string",
      "title": "Account No",
      "description": "Account No",
      "minLength": 10,
      "maxLength": 11,
      "pattern": "^[A-Z0-9-]{10,11}$",
      "width": 110
    },
    "mer_acc_name": {
      "bsonType": "string",
      "title": "Account Name",
      "description": "Account Name",
      "minLength": 1,
      "maxLength": 64,
      "width": 130
    },
    "mer_date": {
      "bsonType": "date",
      "title": "Document Date",
      "description": "Document Date",
      "width": 120
    },
    "mer_po_id": {
      "bsonType": "string",
      "title": "Po ID",
      "description": "Order No",
      "minLength": 1,
      "maxLength": 64,
      "width": 260
    },
    "mer_po_date": {
      "bsonType": "date",
      "title": "PO Date",
      "description": "Purchase Order Date",
      "width": 120
    },
    "mer_sales_doc": {
      "bsonType": "string",
      "title": "Sales Doc",
      "description": "Sales Document Number",
      "minLength": 10,
      "maxLength": 10,
      "pattern": "^[A-Z0-9]{10,10}$",
      "width": 130
    },
    "mer_bu_id": {
      "bsonType": "number",
      "title": "BU ID",
      "description": "Business Unit Id",
      "width": 100
    },
    "mer_bu_name": {
      "bsonType": "string",
      "title": "BU Name",
      "description": "Business Unit Name",
      "enum": ["Consumer", "Retailer", "SMB", "Enterprise"],
      "width": 120
    },
    "mer_odi_no": {
      "bsonType": "string",
      "title": "Ordino No",
      "description": "Main Ordino Number",
      "minLength": 10,
      "maxLength": 24,
      "pattern": "^[0-9A-Z-]{10,20}$",
      "width": 170
    },
    "mer_odi_sub_no": {
      "bsonType": "string",
      "title": "Ordino Sub No",
      "description": "Sub Ordino Number",
      "minLength": 6,
      "maxLength": 20,
      "pattern": "^[0-9A-Z-]{6,20}$"
    },
    "mer_man_no": {
      "bsonType": "string",
      "title": "Manifest No",
      "description": "Customs Manifest Number",
      "minLength": 18,
      "maxLength": 20,
      "width": 150
    },
    "mer_prd_no": {
      "bsonType": "string",
      "title": "Product ID",
      "description": "Product ID",
      "minLength": 7,
      "maxLength": 16,
      "pattern": "^[A-Z0-9-]{7,16}$",
      "replacement": [
        {
          "find": "-",
          "replace": ""
        },
        {
          "find": "_",
          "replace": ""
        }
      ],
      "width": 130
    },
    "mer_prd_description": {
      "bsonType": "string",
      "title": "Description",
      "description": "Product Description",
      "minLength": 1,
      "maxLength": 256,
      "width": 280
    },
    "mer_weight": {
      "bsonType": "number",
      "title": "Weight",
      "description": "Total Weight",
      "default": 0,
      "width": 110
    },
    "mer_qty": {
      "bsonType": "number",
      "title": "Quantity",
      "description": "Quantity",
      "default": 1,
      "width": 80
    },
    "mer_unit_price": {
      "bsonType": "number",
      "title": "Price",
      "description": "Unit Price",
      "default": 0,
      "width": 130
    },
    "mer_amount": {
      "bsonType": "number",
      "title": "Amount",
      "description": "Line Amount",
      "default": 0,
      "width": 110,
      "disabled": false
    },
    "mer_customer_price": {
      "bsonType": "number",
      "title": "Customer Price",
      "description": "Customer Order Price",
      "default": 0,
      "width": 160
    },
    "mer_customer_amount": {
      "bsonType": "number",
      "title": "Customer Amount",
      "description": "Customer Amount",
      "default": 0,
      "disabled": false,
      "width": 180
    },
    "mer_waybill_no": {
      "bsonType": "string",
      "title": "Waybill No",
      "description": "Shipment Waybill Number",
      "minLength": 0,
      "maxLength": 16,
      "width": 150
    },
    "mer_waybill_date": {
      "bsonType": "date",
      "title": "Waybill Date",
      "description": "Waybill Document Date",
      "width": 140
    },
    "mer_invoice_no": {
      "bsonType": "string",
      "title": "Invoice No",
      "description": "Cusomer Invoice Number",
      "minLength": 0,
      "maxLength": 16,
      "width": 130
    },
    "mer_invoice_date": {
      "bsonType": "date",
      "title": "Invoice Date",
      "description": "Cusomer Invoice Date",
      "width": 140
    }
  },
  "required": ["mer_no", "mer_acc_no", "mer_status", "mer_prd_no"],
  "index": [["mer_acc_no"], ["mer_status"], ["mer_prd_no"], ["mer_acc_no", "mer_status"]],
  "unique": [["mer_no", "mer_line_no"]],
  "sort": {
    "_modified_at": -1
  },
  "parents": [
    {
      "collection": "account",
      "match": [
        {
          "key": "mer_acc_no",
          "value": "acc_no"
        }
      ],
      "filter": [
        {
          "key": "acc_is_active",
          "op": "eq",
          "value": true
        }
      ],
      "get": ["acc_no", "acc_name"]
    }
  ],
  "links": [],
  "actions": [
    {
      "id": "standby",
      "title": "StandBy",
      "enabled": true,
      "match": [
        {
          "key": "mer_status",
          "op": "eq",
          "value": "00-Open"
        }
      ],
      "set": [
        {
          "key": "mer_status",
          "value": "01-StandBy"
        }
      ],
      "one_click": true,
      "_tags": ["#Managers", "#Administrators"],
      "notification": {
        "notify": true,
        "subject": "Merchandise are stand by",
        "body": "Hi,<br /><br />We would like to let you know that status of the attached merchandise was changed from 00-Open to 01-StandBy at once.",
        "fields": "mer_no,mer_status",
        "filter": [
          {
            "key": "mer_status",
            "op": "eq",
            "value": "01-StandBy"
          }
        ]
      }
    },
    {
      "id": "ordino",
      "title": "Attach Ordino",
      "enabled": true,
      "match": [
        {
          "key": "mer_status",
          "op": "in",
          "value": "01-StandBy,10-OnTheWay"
        }
      ],
      "set": [
        {
          "key": "mer_status",
          "value": "10-OnTheWay"
        },
        {
          "key": "mer_odi_no",
          "value": null
        },
        {
          "key": "mer_odi_sub_no",
          "value": null
        }
      ],
      "one_click": false,
      "_tags": ["#Managers", "#Administrators"],
      "notification": {
        "notify": true,
        "subject": "Merchandise on the way",
        "body": "Hi,<br /><br />We would like to let you know that status of the attached merchandise was changed from 01-StandBy to 10-OnTheWay.",
        "fields": "mer_no,mer_odi_no,mer_odi_sub_no",
        "filter": [
          {
            "key": "mer_status",
            "op": "eq",
            "value": "10-OnTheWay"
          }
        ]
      }
    },
    {
      "id": "manifest",
      "title": "Attach Manifest",
      "enabled": true,
      "match": [
        {
          "key": "mer_status",
          "op": "in",
          "value": "20-OnCustoms,30-OnCustomsProcess"
        }
      ],
      "set": [
        {
          "key": "mer_status",
          "value": "30-OnCustomsProcess"
        },
        {
          "key": "mer_man_no",
          "value": null
        }
      ],
      "one_click": false,
      "_tags": ["#Managers", "#Administrators"],
      "notification": {
        "notify": true,
        "subject": "Merchandise on customs process",
        "body": "Hi,<br /><br />We would like to let you know that status of the attached merchandise was changed from 20-OnCustoms to 30-OnCustomsProcess.",
        "fields": "mer_no,mer_odi_no,mer_odi_sub_no,mer_man_no",
        "filter": [
          {
            "key": "mer_status",
            "op": "eq",
            "value": "30-OnCustomsProcess"
          }
        ]
      }
    }
  ],
  "triggers": [
    {
      "name": "Amounts updater",
      "enabled": true,
      "operations": ["update", "insert"],
      "changes": [
        {
          "key": "mer_qty",
          "op": "gte",
          "value": 0
        },
        {
          "key": "mer_unit_price",
          "op": "gte",
          "value": 0
        }
      ],
      "conditions": [
        {
          "key": "mer_status",
          "op": "ne",
          "value": "70-Delivered"
        }
      ],
      "targets": [
        {
          "collection": "Merchandise",
          "match": [
            {
              "key": "_id",
              "value": "_id"
            }
          ],
          "filter": [
            {
              "key": "mer_status",
              "op": "ne",
              "value": "70-Delivered"
            }
          ],
          "set": [
            {
              "key": "mer_amount",
              "value": "mer_qty * mer_unit_price"
            }
          ],
          "upsert": false
        },
        {
          "collection": "Merchandise",
          "match": [
            {
              "key": "_id",
              "value": "_id"
            }
          ],
          "filter": [
            {
              "key": "mer_status",
              "op": "ne",
              "value": "70-Delivered"
            }
          ],
          "set": [
            {
              "key": "mer_customer_amount",
              "value": "mer_qty * mer_customer_price"
            }
          ],
          "upsert": false
        },
        {
          "collection": "manifest",
          "match": [
            {
              "key": "man_no",
              "value": "mer_man_no"
            }
          ],
          "filter": [
            {
              "key": "man_status",
              "op": "in",
              "value": "00-Open,10-OnCustomsProcess"
            }
          ],
          "set": [
            {
              "key": "man_amount",
              "value": "sum(mer_amount)"
            }
          ],
          "upsert": false
        }
      ]
    }
  ],
  "views": {
    "mer-general-view": {
      "title": "General View",
      "description": "Merchandise by account and statuses",
      "priority": 2000,
      "enabled": true,
      "dashboard": true,
      "data_filter": [],
      "data_sort": {
        "_modified_at": -1
      },
      "data_excluded": ["inv_mer_no"],
      "data_index": ["acc_nick_name"],
      "data_columns": ["mer_status"],
      "data_values": [
        {
          "key": "mer_no",
          "value": "count"
        }
      ],
      "data_json": true,
      "data_excel": true,
      "data_csv": true,
      "pivot": true,
      "pivot_totals": true,
      "chart": true,
      "chart_type": "Stacked Vertical Bar",
      "chart_label": true,
      "chart_gradient": true,
      "chart_grid": true,
      "chart_legend": false,
      "chart_xaxis": true,
      "chart_xaxis_label": false,
      "chart_yaxis": true,
      "chart_yaxis_label": false,
      "chart_colors": ["#ea5545", "#87bc45", "#27aeef", "#ede15b", "#b33dc6", "#f46a9b", "#ef9b20", "#edbf33", "#bdcf32"],
      "scheduled": true,
      "scheduled_cron": "15 14,15,16 * * mon,tue",
      "scheduled_tz": "Europe/Berlin",
      "_tags": ["#Managers", "#Administrators"]
    },
    "mer-status-view": {
      "title": "Status View",
      "description": "Merchandise Statuses",
      "priority": 2000,
      "enabled": false,
      "dashboard": false,
      "data_filter": [
        {
          "key": "mer_status",
          "op": "in",
          "value": "00-Open,01-StandBy,10-OnTheWay,20-OnCustoms,30-OnCustomsProcess,40-ClearanceCompleted, 50-OnTheTouchpoint,60-ReadyToBeDelivered"
        }
      ],
      "data_sort": {
        "_modified_at": -1
      },
      "data_excluded": [],
      "data_index": ["mer_status"],
      "data_columns": [],
      "data_values": [
        {
          "key": "mer_no",
          "value": "count"
        }
      ],
      "data_json": true,
      "data_excel": true,
      "data_csv": true,
      "pivot": true,
      "pivot_totals": true,
      "chart": true,
      "chart_type": "Pie",
      "chart_label": true,
      "chart_gradient": true,
      "chart_grid": true,
      "chart_legend": false,
      "chart_xaxis": true,
      "chart_xaxis_label": false,
      "chart_yaxis": true,
      "chart_yaxis_label": false,
      "chart_colors": ["#fd7f6f", "#7eb0d5", "#b2e061", "#bd7ebe", "#ffb55a", "#ffee65", "#beb9db", "#fdcce5", "#8bd3c7"],
      "scheduled": false,
      "scheduled_cron": "* 2 * * *",
      "scheduled_tz": "Europe/Berlin",
      "_tags": ["#Managers", "#Administrators"]
    },
    "mer-market-view": {
      "title": "Market Share",
      "description": "By Business Units",
      "priority": 1000,
      "enabled": true,
      "dashboard": true,
      "data_filter": [],
      "data_sort": {
        "_modified_at": -1
      },
      "data_excluded": [],
      "data_index": ["mer_bu_name"],
      "data_columns": [],
      "data_values": [
        {
          "key": "mer_no",
          "value": "count"
        }
      ],
      "data_json": true,
      "data_excel": true,
      "data_csv": true,
      "pivot": true,
      "pivot_totals": true,
      "chart": true,
      "chart_type": "Pie",
      "chart_label": true,
      "chart_gradient": true,
      "chart_grid": true,
      "chart_legend": false,
      "chart_xaxis": true,
      "chart_xaxis_label": false,
      "chart_yaxis": true,
      "chart_yaxis_label": false,
      "chart_colors": ["#e60049", "#0bb4ff", "#9b19f5", "#50e991", "#e6d800", "#ffa300", "#dc0ab4", "#b3d4ff", "#00bfa0"],
      "scheduled": false,
      "scheduled_cron": "* 4 * * *",
      "scheduled_tz": "Europe/Berlin",
      "_tags": ["#Managers", "#Administrators"]
    },
    "fc-status-10": {
      "title": "STby + On the Way",
      "description": "Merchandise stand-by and on the way",
      "priority": 2000,
      "enabled": true,
      "dashboard": true,
      "data_filter": [
        {
          "key": "mer_status",
          "op": "in",
          "value": "01-StandBy,10-OnTheWay"
        }
      ],
      "data_sort": {
        "_modified_at": -1
      },
      "data_excluded": [],
      "data_index": ["mer_status"],
      "data_columns": [],
      "data_values": [
        {
          "key": "mer_no",
          "value": "count"
        }
      ],
      "data_json": true,
      "data_excel": true,
      "data_csv": true,
      "pivot": true,
      "pivot_totals": true,
      "chart": true,
      "chart_type": "Flashcard",
      "chart_label": true,
      "chart_gradient": true,
      "chart_grid": true,
      "chart_legend": false,
      "chart_xaxis": true,
      "chart_xaxis_label": false,
      "chart_yaxis": true,
      "chart_yaxis_label": false,
      "chart_colors": ["#bad7fb", "#ffee65", "#fdcce5", "#8bd3c7", "#b2e061", "#ffb55a", "#7eb0d5", "#fd7f6f", "#bd7ebe"],
      "scheduled": true,
      "scheduled_cron": "0 10 * 1-5 *",
      "scheduled_tz": "Europe/Berlin",
      "_tags": ["#Managers", "#Administrators"]
    },
    "fc-status-20": {
      "title": "On Customs",
      "description": "Merchandise have just arrived",
      "priority": 2000,
      "enabled": true,
      "dashboard": true,
      "data_filter": [
        {
          "key": "mer_status",
          "op": "in",
          "value": "20-OnCustoms"
        }
      ],
      "data_sort": {
        "_modified_at": -1
      },
      "data_excluded": [],
      "data_index": ["mer_status"],
      "data_columns": [],
      "data_values": [
        {
          "key": "mer_no",
          "value": "count"
        }
      ],
      "data_json": true,
      "data_excel": true,
      "data_csv": true,
      "pivot": true,
      "pivot_totals": true,
      "chart": true,
      "chart_type": "Flashcard",
      "chart_label": true,
      "chart_gradient": true,
      "chart_grid": true,
      "chart_legend": false,
      "chart_xaxis": true,
      "chart_xaxis_label": false,
      "chart_yaxis": true,
      "chart_yaxis_label": false,
      "chart_colors": ["#b2e061", "#fd7f6f", "#7eb0d5", "#bd7ebe", "#ffb55a", "#ffee65", "#beb9db", "#fdcce5", "#8bd3c7"],
      "scheduled": false,
      "scheduled_cron": "0 10 * 1-5 *",
      "scheduled_tz": "Europe/Berlin",
      "_tags": ["#Managers", "#Administrators"]
    },
    "fc-status-30": {
      "title": "In Stock",
      "description": "Merchandise arrived at the warehouse",
      "priority": 2000,
      "enabled": true,
      "dashboard": true,
      "data_filter": [
        {
          "key": "mer_status",
          "op": "eq",
          "value": "50-InStock"
        }
      ],
      "data_sort": {
        "_modified_at": -1
      },
      "data_excluded": [],
      "data_index": ["mer_status"],
      "data_columns": [],
      "data_values": [
        {
          "key": "mer_no",
          "value": "count"
        }
      ],
      "data_json": true,
      "data_excel": true,
      "data_csv": true,
      "pivot": true,
      "pivot_totals": true,
      "chart": true,
      "chart_type": "Flashcard",
      "chart_label": true,
      "chart_gradient": true,
      "chart_grid": true,
      "chart_legend": false,
      "chart_xaxis": true,
      "chart_xaxis_label": false,
      "chart_yaxis": true,
      "chart_yaxis_label": false,
      "chart_colors": ["#fd7f6f", "#ffb55a", "#8bd3c7", "#bd7ebe", "#fdcce5", "#ffee65", "#e4e4e4", "#7eb0d5", "#b2e061"],
      "scheduled": false,
      "scheduled_cron": "* 2 * * *",
      "scheduled_tz": "Europe/Berlin",
      "_tags": ["#Managers", "#Administrators"]
    }
  }
}

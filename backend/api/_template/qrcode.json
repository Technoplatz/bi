{
  "properties": {
    "iot_proc": {
      "bsonType": "string",
      "title": "Process",
      "description": "Process Identifier",
      "enum": [
        "in",
        "out"
      ],
      "default": "in",
      "pattern": "^[a-z]{2,3}$",
      "minLength": 2,
      "maxLength": 3,
      "width": 110
    },
    "iot_input": {
      "bsonType": "string",
      "title": "Input",
      "description": "Input Data",
      "pattern": "^[A-Za-z0-9-]{1,32}$",
      "scan": true,
      "minLength": 1,
      "maxLength": 32,
      "width": 200
    }
  },
  "required": [
    "iot_proc",
    "iot_input"
  ],
  "index": [
    [
      "iot_proc"
    ],
    [
      "iot_input"
    ]
  ],
  "unique": [
    [
      "iot_proc",
      "iot_input"
    ]
  ],
  "sort": {
    "_modified_at": -1
  },
  "parents": [
    {
      "name": "CASE",
      "collection": "serial",
      "match": [
        {
          "key": "iot_input",
          "value": "ser_case_no"
        }
      ],
      "filter": [],
      "get": [
        "ser_case_no",
        "ser_dnn_no"
      ]
    },
    {
      "name": "DNs",
      "collection": "serial",
      "match": [
        {
          "key": "iot_input",
          "value": "ser_dnn_no"
        }
      ],
      "filter": [],
      "get": [
        "ser_dnn_no",
        "ser_case_no"
      ]
    }
  ],
  "links": [],
  "actions": [],
  "triggers": [
    {
      "name": "Depot Entries",
      "enabled": true,
      "operations": [
        "insert"
      ],
      "changes": [
        {
          "key": "iot_proc",
          "op": "eq",
          "value": "in"
        }
      ],
      "targets": [
        {
          "collection": "serial",
          "match": [
            {
              "key": "ser_case_no",
              "value": "iot_input"
            }
          ],
          "filter": [],
          "set": [
            {
              "key": "ser_proc_in",
              "value": true
            },
            {
              "key": "ser_proc_in_date",
              "value": "$current_date"
            }
          ],
          "upsert": false
        },
        {
          "collection": "serial",
          "match": [
            {
              "key": "ser_no",
              "value": "iot_input"
            }
          ],
          "filter": [],
          "set": [
            {
              "key": "ser_proc_in",
              "value": true
            },
            {
              "key": "ser_proc_in_date",
              "value": "$current_date"
            }
          ],
          "upsert": false
        }
      ]
    },
    {
      "name": "Depot Outgoing",
      "enabled": true,
      "operations": [
        "insert"
      ],
      "changes": [
        {
          "key": "iot_proc",
          "op": "eq",
          "value": "out"
        }
      ],
      "targets": [
        {
          "collection": "serial",
          "match": [
            {
              "key": "ser_case_no",
              "value": "iot_input"
            }
          ],
          "filter": [
            {
              "key": "ser_proc_in",
              "op": "eq",
              "value": true
            }
          ],
          "set": [
            {
              "key": "ser_proc_out",
              "value": true
            },
            {
              "key": "ser_proc_out_date",
              "value": "$current_date"
            }
          ],
          "upsert": false
        },
        {
          "collection": "serial",
          "match": [
            {
              "key": "ser_no",
              "value": "iot_input"
            }
          ],
          "filter": [
            {
              "key": "ser_proc_in",
              "op": "eq",
              "value": true
            }
          ],
          "set": [
            {
              "key": "ser_proc_out",
              "value": true
            },
            {
              "key": "ser_proc_out_date",
              "value": "$current_date"
            }
          ],
          "upsert": false
        }
      ]
    }
  ],
  "views": {}
}
<!--
Technoplatz BI

Copyright (C) 2019-2023 Technoplatz IT Solutions GmbH, Mustafa Mat

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see https://www.gnu.org/licenses.

If your software can interact with users remotely through a computer
network, you should also make sure that it provides a way for users to
get its source.  For example, if your program is a web application, its
interface could display a "Source" link that leads users to an archive
of the code.  There are many ways you could offer source, and different
solutions will be better for different programs; see section 13 for the
specific requirements.

You should also get your employer (if you work as a programmer) or school,
if any, to sign a "copyright disclaimer" for the program, if necessary.
For more information on this, and how to apply and follow the GNU AGPL, see
https://www.gnu.org/licenses.
-->

<ion-content class="sign-content">
    <ion-grid *ngIf="error" class="ion-no-padding error-grid">
        <ion-row>
            <ion-col class="ion-padding">
                {{ error }}
            </ion-col>
        </ion-row>
    </ion-grid>
    <ion-grid *ngIf="success_str" class="ion-no-padding success-grid">
        <ion-row>
            <ion-col class="ion-padding">
                {{ success_str }}
            </ion-col>
        </ion-row>
    </ion-grid>
    <form [formGroup]="resetForm" *ngIf="formtype=='reset'">
        <ion-item class="section-header" lines="none">
            <h2>{{ 'Reset Password' | translate }}</h2>
        </ion-item>
        <ion-item lines="full">
            <ion-label position="stacked">{{ 'Password' | translate }} <sup>
                    <ion-icon name="star"></ion-icon>
                </sup></ion-label>
            <ion-input #passwordfocus formControlName="password" type="password"
                placeholder="{{ '8-32 uppercase-lowercase-number-sign' | translate }}" class="ion-no-padding" required
                [value]="email">
            </ion-input>
        </ion-item>
        <ion-item lines="full">
            <ion-label position="stacked">{{ 'Two-Factor Access Code' | translate }}
            </ion-label>
            <ion-input #tfacfocus class="ion-no-padding ion-margin-top token" formControlName="tfac" type="text"
                required minlength="6" maxlength="6" size="8" autofocus="true" required="true" autocomplete="off">
            </ion-input>
        </ion-item>
        <ion-item lines="none" class="ion-margin-top">
            <ion-button (click)="Reset()" size="default" [disabled]="!resetForm.valid" class="no-hover">
                <span *ngIf="!isInProgress">{{ 'Set Password' | translate }}</span>
                <ion-spinner *ngIf="isInProgress" name="dots"></ion-spinner>
            </ion-button>
            <ion-button slot="end" fill="outline" (click)="doDismissModal()" size="default" type="reset">
                <span>{{ 'Cancel' | translate }}</span>
            </ion-button>
        </ion-item>
    </form>
    <form [formGroup]="signupForm" *ngIf="formtype=='signup'">
        <ion-item class="section-header" lines="none">
            <h1>{{ 'Sign up' | translate }}</h1>
        </ion-item>
        <ion-item lines="full">
            <ion-label position="stacked">{{ 'User ID' | translate }} <sup>
                    <ion-icon name="star"></ion-icon>
                </sup></ion-label>
            <ion-input #emailfocussignup class="ion-no-padding" formControlName="email" type="email" spellcheck="false"
                autocorrect="off" required placeholder="{{ 'Business E-mail' | translate }}">
            </ion-input>
        </ion-item>
        <ion-item lines="full">
            <ion-label position="stacked">{{ 'Name' | translate }} <sup>
                    <ion-icon name="star"></ion-icon>
                </sup></ion-label>
            <ion-input #namefocus class="ion-no-padding" formControlName="name" type="text" spellcheck="false"
                autocorrect="off" required placeholder="{{ 'Name and Surname' | translate }}">
            </ion-input>
        </ion-item>
        <ion-item lines="full">
            <ion-label position="stacked">{{ 'Password' | translate }} <sup>
                    <ion-icon name="star"></ion-icon>
                </sup></ion-label>
            <ion-input #passwordfocus formControlName="password" type="password"
                placeholder="{{ '8+ characters; a-Z,0-9,sign' | translate }}" required>
            </ion-input>
        </ion-item>
        <ion-item lines="none" class="ion-margin-top">
            <ion-button (click)="Signup()" size="default" class="no-hover ion-margin-end">
                <span *ngIf="!isInProgress">{{ 'Continue' | translate }}</span>
                <ion-spinner *ngIf="isInProgress" name="dots"></ion-spinner>
            </ion-button>
            <ion-button fill="outline" (click)="doDismissModal()" size="default" type="reset">
                <span>{{ 'Cancel' | translate }}</span>
            </ion-button>
        </ion-item>
        <ion-item lines="none" class="ion-no-padding ion-padding-top">
            <ion-icon name="newspaper-outline"></ion-icon>&nbsp;
            <ion-text class="smalli">{{ 'By creating an account, you accept the terms and conditions' | translate
                }}.</ion-text>
        </ion-item>
    </form>
    <form [formGroup]="signinForm" *ngIf="formtype=='signin'">
        <ion-item class="section-header" lines="none">
            <h2>{{ 'Sign in' | translate }}</h2>
        </ion-item>
        <ion-item lines="full">
            <ion-label position="stacked">{{ 'E-mail' | translate }} <sup>
                    <ion-icon name="star"></ion-icon>
                </sup>
            </ion-label>
            <ion-input #emailfocussignin class="ion-no-padding" formControlName="email" type="email" spellcheck="false"
                autocorrect="off" required [value]="email" placeholder="{{ 'Business E-mail' | translate}}">
            </ion-input>
        </ion-item>
        <ion-item lines="full">
            <ion-label position="stacked">{{ 'Password' | translate }} <sup>
                    <ion-icon name="star"></ion-icon>
                </sup>
            </ion-label>
            <ion-input #passwordfocus formControlName="password" type="password" required placeholder="{{ 'User Password' | translate}}">
            </ion-input>
        </ion-item>
        <ion-item lines="none" class="ion-no-padding ion-margin-top">
            <ion-button (click)="Signin()" size="default" class="ion-margin-end" class="sign-button">
                <span *ngIf="!isInProgress">{{ 'Continue' | translate }}</span>
                <ion-spinner *ngIf="isInProgress" name="dots"></ion-spinner>
            </ion-button>
            <ion-button fill="outline" (click)="doDismissModal()" size="default" type="reset">
                <span>{{ 'Cancel' | translate }}</span>
            </ion-button>
            <ion-button slot="end" (click)="doSetOp('forgot')" fill="outline" size="default">
                <span>{{ 'Reset Password' | translate }}</span>
            </ion-button>
        </ion-item>
        <ion-item lines="none" class="ion-margin-top">
            <ion-checkbox formControlName="isRememberMe" [value]="isRememberMe" mode="md" class="ion-margin-end">
            </ion-checkbox><ion-text size="small">{{ 'Remember me' | translate }}</ion-text>
        </ion-item>
    </form>
    <form [formGroup]="TFACForm" *ngIf="formtype=='tfac'">
        <ion-item class="section-header" lines="none">
            <h2>{{ '2F Authentication' | translate }}</h2>
        </ion-item>
        <ion-item lines="full">
            <ion-label position="stacked">{{ 'One Time Password' | translate }}
            </ion-label>
            <ion-input #tfacfocus class="ion-no-padding token" formControlName="tfac" type="text" required minlength="6"
                maxlength="6" size="8" autofocus="true" required="true">
            </ion-input>
        </ion-item>
        <ion-item lines="none" class="ion-no-padding ion-margin-top">
            <ion-button (click)="TFAC()" size="default" class="ion-margin-end" class="sign-button">
                <span *ngIf="!isInProgress">{{ 'Verify' | translate }}</span>
                <ion-spinner *ngIf="isInProgress" name="dots"></ion-spinner>
            </ion-button>
            <ion-button fill="outline" (click)="doDismissModal()" size="default" type="reset">
                <span>{{ 'Cancel' | translate }}</span>
            </ion-button>
        </ion-item>
        <ion-item lines="none" class="ion-no-padding">
            <ion-button fill="clear" (click)="doSetOp('signin')" size="small"
                class="no-hover ion-no-padding clear-dark-button">
                <ion-icon name="mail-outline"></ion-icon>
                <span>{{ 'Your OTP has been sent by e-mail' | translate }}.</span>
            </ion-button>
        </ion-item>
    </form>
    <form [formGroup]="forgotForm" *ngIf="formtype=='forgot'">
        <ion-item class="section-header" lines="none">
            <h2>{{ 'Reset Password' | translate }}</h2>
        </ion-item>
        <ion-item lines="full" class="ion-margin-top">
            <ion-label position="stacked">{{ 'E-mail' | translate }}
            </ion-label>
            <ion-input #emailfocus class="ion-no-padding" formControlName="email" type="email" spellcheck="false"
                autocorrect="off" required>
            </ion-input>
        </ion-item>
        <ion-item lines="none" class="ion-no-padding ion-margin-top">
            <ion-button (click)="doForgot()" size="default" class="ion-margin-end" class="sign-button">
                <span *ngIf="!isInProgress">{{ 'Continue' | translate }}</span>
                <ion-spinner *ngIf="isInProgress" name="dots"></ion-spinner>
            </ion-button>
            <ion-button fill="outline" (click)="doDismissModal()" size="default" type="reset">
                <span>{{ 'Cancel' | translate }}</span>
            </ion-button>
        </ion-item>
    </form>
    <form [formGroup]="successForm" *ngIf="formtype=='success'">
        <ion-item class="section-header" lines="none">
            <h1>{{ 'Thank you' | translate }}!</h1>
        </ion-item>
        <ion-item lines="none">
            <ion-label>
                {{ 'Registration completed successfully' | translate }}.
            </ion-label>
        </ion-item>
        <ion-item lines="none" class="ion-no-padding ion-margin-top ion-margin-bottom">
            <ion-button (click)="doSetOp('signin')" size="default">
                <span>{{ "Sign in" | translate }}</span>
            </ion-button>
        </ion-item>
        <ion-item lines="none" class="ion-no-padding">
            <ion-button fill="clear" (click)="doSetOp('signin')" size="small"
                class="no-hover ion-no-padding clear-dark-button">
                <ion-icon name="log-in-outline"></ion-icon>
                <span>{{ 'Please click the button above to get signed in' | translate }}.</span>
            </ion-button>
        </ion-item>
    </form>
</ion-content>
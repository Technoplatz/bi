{
  "properties": {
    "shp_id": {
      "bsonType": "string",
      "title": "ID",
      "description": "Shipment ID",
      "placeholder": "Automatically assigned",
      "minLength": 14,
      "maxLength": 14,
      "pattern": "^[0-9]{14,14}$",
      "timestamp": true,
      "permanent": true
    },
    "shp_date": {
      "bsonType": "date",
      "title": "Ship Date",
      "description": "Shipment Date",
      "dateOnly": false
    },
    "shp_acc_no": {
      "bsonType": "string",
      "title": "Account No",
      "description": "Account No",
      "minLength": 10,
      "maxLength": 11,
      "pattern": "^[A-Z0-9-]{10,11}$"
    },
    "shp_carrier_name": {
      "bsonType": "string",
      "title": "Carrier Name",
      "description": "Carrier name or driver name surname",
      "placeholder": "Carrier or driver Name",
      "minLength": 2,
      "maxLength": 32
    },
    "shp_carrier_id": {
      "bsonType": "string",
      "title": "Carrier Tax/ID No",
      "description": "Carrier tax no or driver id",
      "placeholder": "Carrier Tax/Id No",
      "minLength": 10,
      "maxLength": 12,
      "pattern": "^[0-9]{10,12}$"
    },
    "shp_vehicle_id": {
      "bsonType": "string",
      "title": "Vehicle Plate",
      "description": "Vehicle plate number",
      "placeholder": "Vehicle plate number",
      "minLength": 6,
      "maxLength": 16,
      "pattern": "^[A-Za-z0-9 ]{6,16}$",
      "caseType": "uppercase"
    },
    "shp_notes": {
      "bsonType": "string",
      "title": "Shipment Notes",
      "description": "Shipment notes to carrier or customer",
      "placeholder": "Shipment Notes",
      "minLength": 0,
      "maxLength": 512
    },
    "shp_wayb_no": {
      "bsonType": "string",
      "title": "Waybill No",
      "description": "Waybill serial number",
      "placeholder": "Waybill No",
      "pattern": "^[A-Z0-9-]{16,18}$",
      "minLength": 0,
      "maxLength": 18,
      "readonly": true
    },
    "shp_wayb_date": {
      "bsonType": "date",
      "title": "Waybill Date",
      "description": "Waybill generated date",
      "readonly": true
    },
    "shp_wayb_ettn": {
      "bsonType": "string",
      "title": "Waybill ETTN",
      "description": "Waybill ETTN",
      "placeholder": "ETTN",
      "pattern": "^[a-z0-9-]{32,40}$",
      "minLength": 32,
      "maxLength": 40,
      "readonly": true
    }
  },
  "sort": {
    "shp_id": -1
  },
  "required": ["shp_id", "shp_date", "shp_acc_no", "shp_carrier_name", "shp_carrier_id", "shp_vehicle_id"],
  "index": [["shp_id"], ["shp_acc_no"], ["shp_wayb_no"]],
  "unique": [["shp_id"]],
  "parents": [
    {
      "collection": "account",
      "match": [
        {
          "key": "shp_acc_no",
          "value": "acc_no"
        }
      ],
      "filter": [
        {
          "key": "acc_is_active",
          "op": "eq",
          "value": true
        }
      ],
      "get": ["acc_no", "acc_name"]
    }
  ],
  "links": [
    {
      "collection": "delivery",
      "get": "dnn_no",
      "match": [
        {
          "key": "dnn_status",
          "op": "eq",
          "value": "60-ReadyToBeDelivered"
        },
        {
          "key": "dnn_acc_no",
          "op": "eq",
          "value": "shp_acc_no"
        }
      ],
      "set": [
        {
          "key": "dnn_wayb_id",
          "value": "shp_id"
        },
        {
          "key": "dnn_status",
          "value": "70-Delivered"
        }
      ],
      "autofill": true,
      "btntext": "delivery",
      "_tags": ["#Technoplatz"]
    }
  ],
  "actions": [
    {
      "id": "waybill-issue",
      "title": "E-Waybill",
      "enabled": true,
      "match": [
        {
          "key": "shp_status",
          "op": "eq",
          "value": "10-Ready"
        }
      ],
      "set": [
        {
          "key": "shp_notes",
          "value": null
        }
      ],
      "one_click": false,
      "icon": "newspaper-outline",
      "uniqueness": false,
      "unique": [],
      "_tags": ["#Managers", "#Administrators"],
      "notification": {
        "notify": true,
        "subject": "DNs Shipped",
        "body": "Hi,<br /><br />We would like to let you know that shipment of attached DNs was completed.",
        "fields": "dnn_no,dnn_status",
        "filter": []
      },
      "apis": [
        {
          "id": "multi-issue",
          "name": "Waybill Issue",
          "enabled": true,
          "url": "http://172.18.0.8/multi-issue",
          "headers": {
            "Content-Type": "application/json"
          },
          "method": "post",
          "map": {
            "tag_prefix": "{http://tempuri.org/}",
            "shipment_collection": "shipment_data",
            "shipment_id_field": "shp_id",
            "shipment_ettn_field": "shp_wayb_ettn",
            "shipment_waybill_no_field": "shp_wayb_no",
            "shipment_waybill_date_field": "shp_wayb_date",
            "shipment_account_no_field": "shp_acc_no",
            "shipment_notes_field": "shp_notes",
            "account_collection": "account_data",
            "account_no_field": "acc_no",
            "delivery_collection": "delivery_data",
            "delivery_shipment_id_field": "dnn_wayb_id",
            "delivery_qty_field": "dnn_qty",
            "delivery_no_field": "dnn_no",
            "delivery_account_no_field": "dnn_acc_no",
            "delivery_product_no_field": "dnn_prd_no",
            "delivery_product_desc_field": "dnn_prd_description",
            "delivery_waybill_no_field": "dnn_wayb_no",
            "delivery_waybill_date_field": "dnn_wayb_date",
            "delivery_status_field": "dnn_status",
            "delivery_set_status": "70-Delivered",
            "document_format": 2
          }
        }
      ]
    },
    {
      "id": "waybill-download",
      "title": "Download",
      "enabled": true,
      "match": [
        {
          "key": "shp_wayb_ettn",
          "op": "nnull",
          "value": null
        }
      ],
      "set": [],
      "noninteractive": true,
      "one_click": false,
      "icon": "cloud-download-outline",
      "uniqueness": false,
      "unique": [],
      "_tags": ["#Managers", "#Administrators"],
      "apis": [
        {
          "id": "waybill-download",
          "name": "Waybill Download",
          "enabled": true,
          "url": "http://172.18.0.8/download",
          "headers": {
            "Content-Type": "application/json"
          },
          "method": "post",
          "map": {
            "tag_prefix": "{http://tempuri.org/}",
            "shipment_collection": "shipment_data",
            "shipment_id_field": "shp_id",
            "shipment_ettn_field": "shp_wayb_ettn",
            "document_format": 2
          }
        }
      ],
      "notification": {
        "notify": true,
        "subject": "DNs Shipped",
        "body": "Hi,<br /><br />We would like to let you know that shipment of attached DNs was completed.",
        "fields": "dnn_no,dnn_status",
        "filter": []
      }
    }
  ],
  "triggers": [],
  "views": {},
  "fetchers": [],
  "import": {}
}
